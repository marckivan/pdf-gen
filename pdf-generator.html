async function exportBothViewsToPdf(item, iframeM, iframeD) {
  try {
    if (!iframeM || !iframeD) {
      alert('Previews not ready. Make sure the file is uploaded and previews have loaded.');
      return;
    }

    await waitForIframe(iframeM);
    await waitForIframe(iframeD);

    const docM = iframeM.contentDocument;
    const docD = iframeD.contentDocument;
    if (!docM || !docD) {
      alert('Unable to access preview content (possibly cross-origin).');
      return;
    }

    // Create export wrapper
    const wrapper = document.createElement('div');
    wrapper.style.background = 'white';
    wrapper.style.color = 'black';
    wrapper.style.width = '100%';
    wrapper.style.fontFamily = 'sans-serif';
    wrapper.style.pageBreakInside = 'avoid';

    // Title
    const titleEl = document.createElement('h2');
    titleEl.textContent = item.title || item.name;
    titleEl.style.margin = '16px 0';
    wrapper.appendChild(titleEl);

    function cloneSection(doc, width, label) {
      const section = document.createElement('div');
      section.style.width = width;
      section.style.margin = '0 auto 20px';
      section.style.pageBreakInside = 'avoid';

      const subtitle = document.createElement('h3');
      subtitle.textContent = label;
      subtitle.style.margin = '8px 0';
      section.appendChild(subtitle);

      // Inline <style> from iframe head
      const styleTag = document.createElement('style');
      Array.from(doc.querySelectorAll('style')).forEach(s => {
        styleTag.textContent += s.textContent + '\n';
      });
      section.appendChild(styleTag);

      // Clone body
      const bodyWrap = document.createElement('div');
      bodyWrap.innerHTML = doc.body.innerHTML;
      section.appendChild(bodyWrap);

      return section;
    }

    // Append Mobile first, then Desktop
    wrapper.appendChild(cloneSection(docM, '375px', 'üì± Mobile View'));
    wrapper.appendChild(cloneSection(docD, '100%', 'üñ•Ô∏è Desktop View'));

    // Place wrapper off-screen but still renderable
    wrapper.style.position = 'absolute';
    wrapper.style.left = '-9999px';
    document.body.appendChild(wrapper);

    // Export to PDF
    const filename = `${(item.title || item.name).replace(/\\s+/g, '_')}.pdf`;
    const opt = {
      margin: 10,
      filename,
      image: { type: 'jpeg', quality: 1 },
      html2canvas: { scale: 2, useCORS: true, allowTaint: true },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    await html2pdf().set(opt).from(wrapper).save();
    wrapper.remove();

  } catch (err) {
    console.error(err);
    alert('Failed to export PDF: ' + (err?.message || err));
  }
}
